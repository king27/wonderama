#summary A view sync version of tron tank webgl demo using websocket

= SceneJS Tron Tank on Liquid Galaxy WebGL Demo =

<img width="720" height="405" src="https://lh5.googleusercontent.com/-ikvunZb7Lsc/Tg1mTIlLFHI/AAAAAAAABRA/7cJA2rEoWek/s720/trongl-2-wonderama.JPG">

== Introduction ==

Firstly a huge *thankyou* to [http://www.retaggr.com/page/LindsayStanleyKay Lindsay Kay] and [http://www.scenejs.org/ SceneJS] for the Tron Tank demo, and [http://www.greggman.com/ Gregg Tavares] for helping to get the view offset maths working this far!

This is just a hack to find out if !WebSocket is viable for achieving multi-machine view synchronisation for WebGL apps.

These variables are sent from the master to the slave views -

  * tankYaw (degrees) - rotation of tank wrt to grid plane
  * tankPos (x,y,z) - position of tank in the world
  * eyePos (x,y,z) - position of camera in the world

For the Master view the camera always !LooksAt tankPos (the is what the original demo does). The Slave views should be slightly to the 'left' and 'right' so a new camera view must be calculated.

*The view sync bit is working, but the math to calculate the offset camera views isn't quite right. Please HELP!*

== How to Build ==

  # Grab the original "tron-tank" source from [http://scenejs.org/dist/curr/extr/examples/tron-tank/index.html SceneJS examples site]. Place this on a local webserver. Test that the original Tron Tank app works with your browser.
  # Download the Perl libraries needed for "relay_websocket.pl" from [http://showmetheco.de/articles/2010/11/timtow-to-build-a-websocket-server-in-perl How To build a WebSocket server in Perl]. Basically get !ReAnimator installed and the demos working from [https://github.com/vti/reanimator https://github.com/vti/reanimator]. May require some support libraries like !EventReactor.
  # Run some of the example !WebSocket Perl services. eg. the 'browser chat' to confirm !WebSocket is working with your browser.
  # Download *tronlg.html*, *tron-tank-lg.js* and *relay_websocket.pl* from this source repo [http://code.google.com/p/wonderama/source/browse/#svn%2Ftrunk%2Ftron-tank /trunk/tron-tank/]
  # Place *tronlg.html* and *tron-tank-lg.js* in the examples/tron-tank folder for the scenejs tron tank (from step 1).
  # Place *relay_websocket.pl* in the examples/ folder for vti's !ReAnimator Perl lib (from step 2). The relay is a basic modification of the "echo" example in that folder.
  # Modify *tron-tank-lg.js* replacing the !WebSocket server IP address with the IP of the machine running your Perl !WebSocket relay'er.
  # There are variables in *tron-tank-lg.js* to set the fov and bezel multiplier. If you've gotten this far, you'll know what to do!

== How to run it ==

  # Run the Perl service *./relay_websocket.pl*
  # From a webgl browser on the middle machine access *http://.../tronlg.html?master *
  # on the right-hand screens access *http://.../tronlg.html?rot=-1 * or -2, -3, etc.
  # on the left-hand machines use *http://.../tronlg.html?rot=1 * or 2, 3, etc.
  # Use mouse on the Master instance to control the tank and camera position.

You should run the Master (center) up first, followed by the slaves. After the initial setup you can reload any instance and things will work, since the Master view is the only one transmitting.

== What needs fixing == 

<wiki:video url="http://www.youtube.com/watch?v=53Xc4V6QZlQ">
  * *slave view offsets aren't right, trying pitching up towards 90 degrees. 3D matrix maths anyone?*
    * probably something in cameraLookAt() function.
  * the websocket relay needs smarts to differentiate master and slave clients and when to drop clients.
  * need to dynamically resize and fullscreen the canvas. CSS?
  * the camera (eye) doesn't seem to go all the way down to the ground anymore. pitch code may be broken on master.
  * code cleanup because of my hack job!

== Future Ideas ==

  * add user-controllable or orbiting camera in addition to the "swing to front" view.
  * need to find a !SpaceNavigator Javascript control? Perhaps [http://code.google.com/p/javascript-joystick/ javascript-joystick] will do.
  * procedural city/block model generator.
  * ability to fire the canon and blow stuff up!
  * other tanks and light cycles.
  * grid texture is a bit so-so, replace it with better image or draw it.
  * sound fx, followed by spatial sound fx
  * multiplayer tanks, network play, etc.
  * 2d overview map, compass, radar, headsup display, map/maze builder
  * revitalize and/or re-use code from [http://kernigh.pbworks.com/w/page/9214137/Xtank Xtank] (early 1990's) or [http://www.gltron.org/ GLtron]  _...getting carried away..._
 